---
title: 加密体系
date: 2018-04-09 10:46:05
comments: true
categories:
- 信息安全
- 加密
---

# 消息摘要
## 消息摘要的作用
在网络安全目标中，要求信息在生成、存储或传输过程中保证不被偶然或蓄意地删除、修改、伪造、乱序、重放、插入等破坏和丢失，因此需要一个较为安全的标准和算法，以保证数据的完整性。

**常见的消息摘要算法** ： MD5 ，SHA

<!--more-->

## Hash函数
消息摘要算法采用单向散列（hash）函数从明文产生摘要密文。

散列函数的输出值有固定的长度，该散列值是消息M的所有位的函数并提供错误检测能力，消息中的任何一位或多位的变化都将导致该散列值的变化。从散列值不可能推导出消息M ，也很难通过伪造消息M’来生成相同的散列值。

Hash函数的值称为作为自变量的消息的“散列值”或“消息摘要”、“数字指纹”

> 消息M -> Hash函数 -> 散列值h
> (原像).......(映射)............(映像)

不同的原像映射出相同的映象称为“碰撞”或“冲突”

映象相同的两个原像互称为“等价原像”

###抗碰撞性

弱抗碰撞性(Weak collision resistance):

对于任意给定的M，找到满足 M≠N 且H(M)=H(N)的N，在计算上是不可行的；

强抗碰撞性(Strong collision resistance):

找到任何满足H(x)= H(y) 的偶对(x，y)在计算上是不可行的。

### Hash函数的分类
根据安全水平:
1. 弱抗碰撞
2. 强抗碰撞

根据是否使用密钥:
1. 使用密钥，此时散列值称作 MAC(Message Authentication Code)
2. 不使用密钥，此时散列值称作 MDC(Message Detection Code)

###Hash函数的应用

1. 由Hash函数产生消息的散列值,以消息的散列值来判别消息的完整性
2. 用加密消息的散列值来产生数字签名
3. 用口令的散列值来安全存储口令（认证系统中的口令列表中仅存储口令的Hash函数值，以避免口令被窃取。认证时用输入口令的Hash函数值与其比较）

##消息摘要的安全隐患

无法完全阻止数据的修改。

如果在数据传递过程中，窃取者将数据窃取出来，并且修改数据，再重新生成一次摘要，将改后的数据和重新计算的摘要发送给接收者，接收者利用算法对修改过的数据进行验证时，生成的消息摘要和收到的消息摘要仍然相同，消息被判断为“没有被修改”。

所以除了需要知道消息和消息摘要之外，还需要知道发送者身份---消息验证码。

# 消息验证码
即MAC(带密钥的哈希函数)

简单来说，发送者A和接受者B之间共同拥有一个密钥key，A将消息摘要用key加密。
然后连同数据一起发给B。

B接收到之后，先用key对消息摘要解密，然后本地计算数据的消息摘要与解密得到的进行对比。

可以防止数据被修改。因为篡改者没有key。
## 消息验证码的局限性
消息验证码可以保护信息交换双方不受第三方的攻击，但是它不能处理通信双方的相互攻击

信宿方可以伪造消息并称消息发自信源方，信源方产生一条消息，并用和信宿方共享的密钥产生认证码，并将认证码附于消息之后

信源方可以否认曾发送过某消息，因为信宿方可以伪造消息，所以无法证明信源方确实发送过该消息

在收发双方不能完全信任的情况下，引入数字签名来解决上述问题,数字签名的作用相当于手写签名

# 消息认证
消息认证（message authentication）就是验证消息的完整性，当接收方收到发送方的报文时，接收方能够验证收到的报文是真实的和未被篡改的。它包含两层含义：一是验证信息的发送者是真正的而不是冒充的，即数据起源认证；二是验证信息在传送过程中未被篡改、重放或延迟等。
## 消息认证的方式
1. 加密认证——用消息的密文本身充当认证信息
2. 消息认证码MAC——由以消息和密钥作为输入的公开函数产生的认证信息
3. 散列值──由以消息作为唯一输入的散列函数产生的认证信息（无需密钥）

### 基于消息加密的认证
#### 用对称密码体制进行加密认证
过程──用同一密钥加密、解密消息

作用──认证+保密

原理──攻击者无法通过改变密文来产生所期望的明文变化

特点──接收方需要判别消息本身的逻辑性或合法性。“我请你吃饭”被乱改成“我请你謯斸”

#### 私钥加密，公钥解密

过程──发送者用自己的私钥加密明文、接收者用发送者的公钥解密密文

作用──认证及签名，但不保密

原理──因不知发送者的私钥，故其他人无法产生密文或伪造签名

若用公钥加密、私钥解密，则无法起到认证的作用。因为知道公钥的人都可以通过产生伪造的密文来篡改消息。

#### 用私钥、公钥双重加密、解密
过程──发送者先用自己的私钥加密明文，再用接收者的公钥加密一次；接收者先用自己的私钥解密密文，再用发送者的公钥解密一次

作用──认证、签名，且保密

原理──认证、签名由发送者的私钥加密实现；保密性由接收者的公钥加密保证

### 基于消息验证码MAC的认证
产生──发送者以消息M和与接收者共享的密钥K为输入，通过某公开函数C进行加密运算得到MAC

传送并接收──M+MAC

认证──接收者以接收到的M和共享密钥K为输入，用C重新加密算得MAC’ ，若MAC’=MAC，则可确信M未被篡改

作用──认证，但不保密

### 基于散列值的认证
1. 对附加了散列值的消息实施对称加密，得到并发送Ek(M+H(M)) —— 认证+保密
2. 仅对散列值实施对称加密，得到Ek(H(M))，并与M一起发送 —— 认证+不保密
3. 对散列值实施私钥加密，得到EKRa(H(M))并与M一起发送 —— 认证+签名，不保密
4. 将消息与用私钥加密后的散列值一起再用共享密钥加密，最后得到Ek(M+EKRa(H(M)))并发送 —— 认证+签名+保密
5. 将消息串接一个由通信各方共享的密值S后计算散列值，得到H(M+S)并与M一起发送 —— 认证，不保密
6. 先将消息串接一个由通信各方共享的密值S后计算散列值，再将它与消息M一起用共享密钥加密，最后得到Ek(M+H(M+S))并发送 —— 认证+保密

# 数字签名

在公钥体制中，用接受者的公钥加密消息得到密文，接受者用自己的私钥解密密文得到消息。加密过程任何人都能完成，解密过程只有接受者能够完成。

考虑一种相反的过程，发送者用自己的私钥“加密”消息得到“密文”，然后利用发送者的公钥“解密”密文得到消息。

很显然，加密只有发送者能够完成，而解密任何人都可以完成。 所以，任何人都可相信是特定的发送者产生了该消息，这就相当于“签名”，证明一个消息的所属。

## 数字签名的特点
传统签名的基本特点:
1. 与被签的文件在物理上不可分割
2. 签名者不能否认自己的签名
3. 签名不能被伪造
4. 容易被验证

数字签名是传统签名的数字化:
1. 能与所签文件“绑定”
2. 签名者不能否认自己的签名
3. 容易被自动验证
4. 签名不能被伪造

数字签名必须具有下述特征

1. 收方能够确认或证实发方的签名，但不能伪造，简记为R1-条件（unforgeable）
2. 发方发出签名的消息给收方后，就不能再否认他所签发的消息，简记为S-条件(non-repudiation)
3. 收方对已收到的签名消息不能否认，即有收报认证，简记作R2-条件
4. 第三者可以确认收发双方之间的消息传送，但不能伪造这一过程，简记作T-条件

## 数字签名与消息认证的区别
1. 与手书签名的区别：手书签名是模拟的，且因人而异。数字签名是0和1的数字串，因消息而异。
2. 与消息认证的的区别：消息认证使收方能验证消息发送者及所发消息内容是否被窜改过。当收发者之间没有利害冲突时，这对于防止第三者的破坏来说是足够了。但当收者和发者之间有利害冲突时，就无法解决他们之间的纠纷，此时须借助满足前述要求的数字签名技术。
3. 与消息加密区别：消息加密和解密可能是一次性的，它要求在解密之前是安全的；而一个签名的消息可能作为一个法律上的文件，如合同等，很可能在对消息签署多年之后才验证其签名，且可能需要多次验证此签名。因此，签名的安全性和防伪造的要求更高些，且要求证实速度比签名速度还要快，特别是联机在线实时验证。

## 数字签名的分类
根据签名的内容分:

1. 对整体消息的签名
2. 对压缩消息的签名

按明、密文的对应关系划分:

1. 确定性(Deterministic)数字签名，其明文与密文一一对应，它对一特定消息的签名不变化，如RSA、Rabin等签名；
2. 随机化的(Randomized)或概率式数字签名

## 数字签名常见算法
普通数字签名算法
1. RSA
2. ElGamal /DSS/DSA
3. ECDSA

盲签名算法

群签名算法

### RSA
![](http://ozrmo3j0k.bkt.clouddn.com/Selection_004.png)

### 盲签名

一般数字签名中，总是要先知道文件内容而后才签署，这正是通常所需要的。但有时需要某人对一个文件签名，但又不让他知道文件内容，称此为盲签名(Blind Signature)

Chaum在1983年提出

适应于电子选举、数字货币协议中

### 群签名

群体密码学由Desmedt于1987年提出，群签名是群体密码学中的课题，1991由Chaum和van Heyst提出，其特点有：
1. 一个群体中的任意一个成员可以匿名地代表整个群体进行签名；
2. 接收到签名的人可以用公钥验证群签名，但不可能知道由群体中哪个成员所签；
3. 发生争议时可由群体中的成员或可信赖机构识别群签名的签名者。

# 数字水印

数字水印（Digital Watermark）是指永久镶嵌在其它数据（主要指宿主数据）中具有可鉴别性的数字信号或数字模式。

## 特点
1. 不可感知性（imperceptible）：包括视觉上的不可见性和水印算法的不可推断性。
2. 鲁棒性（Robustness）：嵌入水印必须难以被一般算法清除。也就是说多媒体信息中的水印能够抵抗各种对数据的破坏，如A/D 、D/A转换、重量化、滤波、平滑、有失真压缩以及旋转、平移、缩放及分割等几何变换和恶意的攻击等。
3. 可证明性：指对嵌有水印信息的图像，可以通过水印检测器证明嵌入水印的存在。
4. 自恢复性：指含水印的图像在经受一系列攻击后（图像可能有较大的破坏），水印信息也经过了各种操作或变换。但可以通过一定的算法从剩余的图像片段中恢复出水印信息，而不需要整个原始图像的特性。
5. 安全保密性：数字水印系统使用一个或多个密钥以确保安全，防止修改和擦除。同时若与密码学进行有机的结合，对数据可起到双重加密作用。

# 数字证书

任何的密码体制都不是坚不可摧的，公开密钥体制也不例外。由于公开密钥体制的公钥是对所有人公开的，从而免去了密钥的传递，简化了密钥的管理。

但是这个公开性在给人们带来便利的同时，也给攻击者冒充身份篡改公钥有可乘之机。所以，密钥也需要认证，在拿到某人的公钥时，需要先辨别一下它的真伪。这时就需要一个认证机构，将身份证书作为密钥管理的载体，并配套建立各种密钥管理设施。

数字证书（Digital Certificate）又称为数字标识（Digital ID）。它提供一种在Internet上验证身份的方式，是用来标志和证明网络通信双方身份的数字信息文件。

数字安全证书是由权威公正的第三方机构即CA中心签发的。它是在证书申请被认证中心批准后，通过登记服务机构将其发放给申请者。
## 数字证书的内容

最简单的证书包含一个公开密钥、名称以及证书授权中心的数字签名。一般情况下证书中还包括密钥的有效时间，发证机关(证书授权中心)的名称，该证书的序列号等信息，证书的格式遵循ITU-T X.509国际标准。


一个标准的X.509数字安全证书包含以下一些内容：
1. 证书的版本号。不同的版本的证书格式也不同，在读取证书时首先需要检查版本号。
2. 证书的序列号。每个证书都有一个唯一的证书序列号。
3. 证书所使用的签名算法标识符。签名算法标识符表明数字签名所采用的算法以及使用的参数。
4. 证书的发行机构名称。创建并签署证书的CA的名称，命名规则一般采用X.500格式。
5. 证书的有效期。证书的有效期由证书有效起始时间和终止时间来定义。
6. 证书所有人的名称。命名规则一般采用X.500格式；
7. 证书所有人的公开密钥及相关参数。相关参数包括加密算法的标识符及参数等
8. 证书发行机构ID。这是版本2中增加的可选字段。
9. 证书所有人ID。这是版本2中增加的可选字段。
10. 扩展域。这是版本3中增加的字段，它是一个包含若干扩展字段的集合。
11. 证书发行机构对证书的签名，即CA对证书内除本签名字段以外的所有字段的数字签名。

## 认证中心
CA（Certificate Authority，认证中心）作为权威的、可信赖的、公正的第三方机构，专门负责发放并管理所有参与网上交易的实体所需的数字证书。

CA作为一个权威机构，对密钥进行有效地管理，颁发证书证明密钥的有效性，并将公开密钥同某一个实体（消费者、商户、银行）联系在一起。

### CA的主要职责
1. 颁发证书：如密钥对的生成、私钥的保护等，并保证证书持有者应有不同的密钥对。
2. 管理证书：记录所有颁发过的证书，以及所有被吊销的证书。
3. 用户管理：对于每一个新提交的申请，都要和列表中现存的标识名相比较，如出现重复，就给予拒绝。
4. 吊销证书：在证书有效期内使其无效，并发表CRL（Certificate Revocation List，被吊销的证书列表）
5. 验证申请者身份：对每一个申请者进行必要的身份认证。
6. 保护证书服务器：证书服务器必须安全的，CA应采取相应措施保证其安全性。
7. 保护CA私钥和用户私钥：CA签发证书所用的私钥要受到严格的保护，不能被毁坏，也不能被非法使用。同时，根据用户密钥对的产生方式，CA在某些情况下有保护用户私钥的责任。
8. 审计和日志检查：为了安全起见，CA对一些重要的操作应记入系统日志。在CA发生事故后，要根据系统日志做善后追踪处理――审计，CA管理员要定期检查日志文件，尽早发现可能的隐患。

### CA的基本组成
认证中心主要有三个部分组成:
1. 注册服务器（RS）：面向用户，包括计算机系统和功能接口；
2. 注册中心（RA）：负责证书的审批；
3. 认证中心（CA）：负责证书的颁发，是被信任的部门

一个完整的安全解决方案除了有认证中心外，一般还包括以下几个方面：

1. 密码体制的选择
2. 安全协议的选择
2.1 SSL（Secure Socket Layer 安全套接字层）
2.2 S-HTTP（Secure HTTP，安全的http协议）
2.3 SET（Secure Electonic Transaction，安全电子交易协议）

### CA的三层体系结构
-   第一层为RCA（Root Certificate Authority，根认证中心）。它的职责是负责制定和审批CA的总政策，签发并管理第二层CA的证书，与其它根CA进行交叉认证。
-   第二层为BCA（Brand Certificate Authority，品牌认证中心）。它的职责是根据RCA的规定，制定具体政策、管理制度及运行规范；签发第三层证书并进行证书管理。
-   第三层为ECA（End user CA，终端用户CA）。它为参与电子商务的各实体颁发证书。签发的证书可分为三类：分别是支付网关（Payment Gateway）、持卡人（Cardholder）和商家（Merchant）签发的证书；签发这三种证书的CA对应的可称之为PCA、CCA和MCA。
